/**
 * Copyright (c) 2013-2014 INRIX, Inc.
 * 
 * INRIX is a registered trademark of INRIX, Inc. Any copyright, patent and
 * trademark notice(s) contained herein or in related code, files or
 * documentation shall not be altered and shall be included in all copies and
 * substantial portions of the software.
 */

package com.inrix.reference.trafficapp;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;
import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertTrue;

import java.lang.reflect.Method;
import java.util.Collections;
import java.util.List;

import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.robolectric.Robolectric;
import org.robolectric.RobolectricTestRunner;
import org.robolectric.shadows.ShadowDrawable;
import org.robolectric.shadows.ShadowLog;
import org.simpleframework.xml.Serializer;
import org.simpleframework.xml.core.Persister;

import utils.FragmentUtils;
import android.location.Location;
import android.text.TextUtils;
import android.widget.ImageView;
import android.widget.ListView;
import android.widget.TextView;

import com.inrix.sdk.IncidentUtils;
import com.inrix.sdk.InrixCore;
import com.inrix.sdk.model.Incident;
import com.inrix.sdk.model.IncidentCollection;
import com.inrix.reference.trafficapp.incidents.IncidentDisplayUtils;
import com.inrix.reference.trafficapp.incidents.IncidentsListAdapter;
import com.inrix.reference.trafficapp.incidents.IncidentsListFragment;
import com.inrix.reference.trafficapp.view.IncidentCard;

@RunWith(RobolectricTestRunner.class)
public class IncidentsPageTest {

	IncidentsListFragment incidentsFrag = null;
	private ListView incidentsListView = null;
	private static String incidentsXml = "<Inrix statusId=\"0\" statusText=\"\" responseId=\"cb415f7e-d9e5-4fee-8e1d-b0436bc4ccc6\"><Incidents><Incident id=\"820010076\" version=\"38\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.623142\" longitude=\"-122.330443\" impacting=\"Y\" startTime=\"2013-12-25T00:00:00Z\" endTime=\"2014-06-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Republican Street : Construction between Pontius Avenue and Yale Avenue </ShortDesc><FullDesc xml:lang=\"en-US\">Intermittent lane closures due to construction on Republican Street both ways between Pontius Avenue and Yale Avenue.</FullDesc><TMCs><TMC code=\"114N08575\" /><TMC code=\"114-08575\" /><TMC code=\"114P08575\" /><TMC code=\"114+08575\" /></TMCs><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>Republican Street</RoadName><Direction>BOTH</Direction><FromLocation>Belltown Northbound</FromLocation><ToLocation>Southbound</ToLocation><Crossroad1 tmcCode=\"114N08575\">Pontius Avenue </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"859125834\" version=\"29\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.616948\" longitude=\"-122.33274\" impacting=\"Y\" startTime=\"2014-02-24T00:00:00Z\" endTime=\"2015-03-02T07:59:00Z\"><ShortDesc xml:lang=\"en-US\">Stewart Street : Construction at Boren Avenue </ShortDesc><FullDesc xml:lang=\"en-US\">Intermittent lane closures due to construction on Stewart Street both ways near Boren Avenue.</FullDesc><TMCs><TMC code=\"114N11378\" /><TMC code=\"114-11378\" /><TMC code=\"114P11378\" /><TMC code=\"114+11378\" /></TMCs><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>Stewart Street</RoadName><Direction>BOTH</Direction><FromLocation>Capitol Hill Eastbound</FromLocation><ToLocation>Belltown Westbound</ToLocation><Crossroad1 tmcCode=\"114N11378\">Boren Avenue </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"912271680\" version=\"18\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.62205\" longitude=\"-122.338472\" impacting=\"Y\" startTime=\"2014-03-18T00:00:00Z\" endTime=\"2014-06-02T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Westlake Avenue : Construction between Republican Street and Harrison Street </ShortDesc><FullDesc xml:lang=\"en-US\">Intermittent lane closures due to construction on Westlake Avenue both ways between Republican Street and Harrison Street.</FullDesc><TMCs><TMC code=\"114N11599\" /><TMC code=\"114-11599\" /><TMC code=\"114P11599\" /><TMC code=\"114+11599\" /></TMCs><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>Westlake Avenue</RoadName><Direction>BOTH</Direction><FromLocation>Northbound</FromLocation><ToLocation>Seattle Southbound</ToLocation><Crossroad1 tmcCode=\"114N11599\">Republican Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"953449736\" version=\"11\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.611521\" longitude=\"-122.339787\" impacting=\"Y\" startTime=\"2014-03-31T07:00:00Z\" endTime=\"2014-05-31T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">3rd Avenue : Construction between Pine Street and Stewart Street </ShortDesc><FullDesc xml:lang=\"en-US\">Intermittent lane closures due to construction on 3rd Avenue both ways between Pine Street and Stewart Street.</FullDesc><TMCs><TMC code=\"114N08515\" /><TMC code=\"114-08515\" /><TMC code=\"114P08515\" /><TMC code=\"114+08515\" /></TMCs><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>3rd Avenue</RoadName><Direction>BOTH</Direction><FromLocation>Northbound</FromLocation><ToLocation>Queen Anne Southbound</ToLocation><Crossroad1 tmcCode=\"114N08515\">Pine Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"956384708\" version=\"11\" type=\"1\" severity=\"2\" eventCode=\"735\" latitude=\"47.60373\" longitude=\"-122.33844\" impacting=\"Y\" startTime=\"2014-03-31T23:00:00Z\" endTime=\"2014-05-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Alaskan Way : Road closed between Atlantic Street and Madison Street </ShortDesc><FullDesc xml:lang=\"en-US\">Alaskan Way both ways closed due to WA-99 tunnel project between Atlantic Street and Madison Street.</FullDesc><TMCs><TMC code=\"114P08078\" /><TMC code=\"114+08078\" /><TMC code=\"114P08077\" /><TMC code=\"114+08077\" /><TMC code=\"114P08076\" /><TMC code=\"114+08076\" /><TMC code=\"114P08075\" /><TMC code=\"114+08075\" /><TMC code=\"114N08074\" /><TMC code=\"114-08074\" /><TMC code=\"114N08075\" /><TMC code=\"114-08075\" /><TMC code=\"114N08076\" /><TMC code=\"114-08076\" /><TMC code=\"114N08077\" /><TMC code=\"114-08077\" /></TMCs><ParameterizedDescription eventCode=\"735\"><EventText>Closed due to roadworks</EventText><RoadName>Alaskan Way</RoadName><Direction>BOTH</Direction><FromLocation>Southbound</FromLocation><ToLocation>Belltown Northbound</ToLocation><Crossroad1 tmcCode=\"114P08074\">Atlantic Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.79\" /></Incident><Incident id=\"956784336\" version=\"11\" type=\"1\" severity=\"2\" eventCode=\"735\" latitude=\"47.62209\" longitude=\"-122.345862\" impacting=\"Y\" startTime=\"2014-04-01T23:00:00Z\" endTime=\"2014-05-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Harrison Street : Road closed between WA-99 Aurora Avenue and Broad Street </ShortDesc><FullDesc xml:lang=\"en-US\">Harrison Street both ways closed due to WA-99 Tunnel Project between WA-99 Aurora Avenue and Broad Street.</FullDesc><TMCs /><ParameterizedDescription eventCode=\"735\"><EventText>Closed due to roadworks</EventText><RoadName>Harrison Street</RoadName><Direction>BOTH</Direction><Crossroad1>WA-99 Aurora Avenue </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"956784340\" version=\"11\" type=\"1\" severity=\"2\" eventCode=\"735\" latitude=\"47.623224\" longitude=\"-122.344127\" impacting=\"Y\" startTime=\"2014-04-01T23:00:00Z\" endTime=\"2014-05-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Repuplican Street : Road closed between WA-99 Aurora Avenue and 6th Avenue </ShortDesc><FullDesc xml:lang=\"en-US\">Repuplican Street both ways closed due to WA-99 Tunnel Project between WA-99 Aurora Avenue and 6th Avenue.</FullDesc><TMCs /><ParameterizedDescription eventCode=\"735\"><EventText>Closed due to roadworks</EventText><RoadName>Repuplican Street</RoadName><Direction>BOTH</Direction><Crossroad1>WA-99 Aurora Avenue </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"979994954\" version=\"7\" type=\"1\" severity=\"2\" eventCode=\"735\" latitude=\"47.65064\" longitude=\"-122.307742\" impacting=\"Y\" startTime=\"2014-02-01T08:00:00Z\" endTime=\"2015-09-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Pacific Place W/B : Road closed between WA-513 Montlake Boulevard and Pacific Street </ShortDesc><FullDesc xml:lang=\"en-US\">Pacific Place Westbound closed due to bridge maintenance work between WA-513 Montlake Boulevard and Pacific Street.</FullDesc><TMCs /><ParameterizedDescription eventCode=\"735\"><EventText>Closed due to roadworks</EventText><RoadName>Pacific Place</RoadName><Direction>WB</Direction><Crossroad1>WA-513 Montlake Boulevard </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"1012627796\" version=\"3\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.64441\" longitude=\"-122.30432\" impacting=\"N\" startTime=\"2014-04-22T04:00:07Z\" endTime=\"2014-04-22T12:00:07Z\"><ShortDesc xml:lang=\"en-US\">WA-520 : Right lane closed between Evergreen Point Floating Brg and Montlake Boulevard </ShortDesc><FullDesc xml:lang=\"en-US\">Right lane closed due to electricity work and concrete pour work on WA-520 both ways between Evergreen Point Floating Brg and Montlake Boulevard.</FullDesc><TMCs><TMC code=\"114N04229\" /><TMC code=\"114-04229\" /><TMC code=\"114N04230\" /><TMC code=\"114-04230\" /><TMC code=\"114P04231\" /><TMC code=\"114+04231\" /><TMC code=\"114P04230\" /><TMC code=\"114+04230\" /></TMCs><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>Wa-520</RoadName><Direction>BOTH</Direction><FromLocation>Redmond Eastbound</FromLocation><ToLocation>Broadway Westbound</ToLocation><Crossroad1 tmcCode=\"114N04231\">Evergreen Point Floating Brg </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.02\" fromFreeFlowMinutes=\"0.02\" distance=\"1.06\" /></Incident><Incident id=\"1019396680\" version=\"2\" type=\"4\" severity=\"3\" eventCode=\"245\" latitude=\"47.643177\" longitude=\"-122.322801\" impacting=\"N\" startTime=\"2014-04-22T05:36:18Z\" endTime=\"2014-04-22T07:12:24Z\"><ShortDesc xml:lang=\"en-US\">I-5 N/B : Accident at Roanoke Street </ShortDesc><FullDesc xml:lang=\"en-US\">Two lanes closed and delays due to accident on I-5 Northbound at Roanoke Street.</FullDesc><TMCs><TMC code=\"114P04200\" /><TMC code=\"114+04200\" /></TMCs><ParameterizedDescription eventCode=\"245\"><EventText>Accident(s). Two lanes blocked</EventText><RoadName>I-5</RoadName><Direction>NB</Direction><FromLocation>Southbound</FromLocation><ToLocation>Northbound</ToLocation><Crossroad1 tmcCode=\"114P04200\">Roanoke Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"820008792\" version=\"38\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.60179\" longitude=\"-122.33663\" impacting=\"Y\" startTime=\"2012-05-10T15:00:00Z\" endTime=\"2014-06-01T02:59:00Z\"><ShortDesc xml:lang=\"en-US\">Alaskan Way : Construction between Madison Street and Yesler Way </ShortDesc><FullDesc xml:lang=\"en-US\">Construction on Alaskan Way both ways between Madison Street and Yesler Way.</FullDesc><TMCs><TMC code=\"114N08076\" /><TMC code=\"114-08076\" /><TMC code=\"114N08077\" /><TMC code=\"114-08077\" /><TMC code=\"114P08078\" /><TMC code=\"114+08078\" /><TMC code=\"114P08077\" /><TMC code=\"114+08077\" /></TMCs><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>Alaskan Way</RoadName><Direction>BOTH</Direction><FromLocation>Belltown Northbound</FromLocation><ToLocation>Southbound</ToLocation><Crossroad1 tmcCode=\"114N08078\">Madison Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.17\" /></Incident><Incident id=\"820009086\" version=\"38\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.619705\" longitude=\"-122.342381\" impacting=\"Y\" startTime=\"2013-12-25T00:00:00Z\" endTime=\"2014-10-02T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Dexter Avenue : Construction at John Street </ShortDesc><FullDesc xml:lang=\"en-US\">Intermittent lane closures due to construction on Dexter Avenue both ways at John Street.</FullDesc><TMCs /><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>Dexter Avenue</RoadName><Direction>BOTH</Direction><Crossroad1>John Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"820011772\" version=\"38\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.624517\" longitude=\"-122.339744\" impacting=\"Y\" startTime=\"2014-01-10T08:00:00Z\" endTime=\"2015-06-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Mercer Street : Construction between 4th Avenue and 9th Avenue </ShortDesc><FullDesc xml:lang=\"en-US\">Intermittent lane closures due to construction on Mercer Street both ways between 4th Avenue and 9th Avenue.</FullDesc><TMCs><TMC code=\"114P08228\" /><TMC code=\"114+08228\" /><TMC code=\"114N08227\" /><TMC code=\"114-08227\" /></TMCs><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>Mercer Street</RoadName><Direction>BOTH</Direction><FromLocation>Queen Anne Westbound</FromLocation><ToLocation>Capitol Hill Eastbound</ToLocation><Crossroad1 tmcCode=\"114P08227\">4th Avenue </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.61\" /></Incident><Incident id=\"820012002\" version=\"38\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.61855\" longitude=\"-122.346306\" impacting=\"Y\" startTime=\"2014-04-14T14:00:00Z\" endTime=\"2014-09-02T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Taylor Avenue : Construction between John Street and Denny Way </ShortDesc><FullDesc xml:lang=\"en-US\">Intermittent lane closures due to construction on Taylor Avenue both ways between John Street and Denny Way.</FullDesc><TMCs><TMC code=\"114N11441\" /><TMC code=\"114-11441\" /><TMC code=\"114P11441\" /><TMC code=\"114+11441\" /></TMCs><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>Taylor Avenue</RoadName><Direction>BOTH</Direction><FromLocation>Northbound</FromLocation><ToLocation>Belltown Southbound</ToLocation><Crossroad1 tmcCode=\"114N11441\">John Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"820014030\" version=\"38\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.624292\" longitude=\"-122.331745\" impacting=\"Y\" startTime=\"2013-12-25T00:00:00Z\" endTime=\"2014-06-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Pontius Avenue : Construction at Mercer Street </ShortDesc><FullDesc xml:lang=\"en-US\">Intermittent lane closures due to construction on Pontius Avenue both ways at Mercer Street.</FullDesc><TMCs /><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>Pontius Avenue</RoadName><Direction>BOTH</Direction><Crossroad1>Mercer Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"1.12\" /></Incident><Incident id=\"820015516\" version=\"38\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.62204\" longitude=\"-122.33977\" impacting=\"Y\" startTime=\"2013-12-25T00:00:00Z\" endTime=\"2014-05-02T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">9th Avenue : Construction between Republican Street and Harrison Street </ShortDesc><FullDesc xml:lang=\"en-US\">Intermittent lane closures due to construction on 9th Avenue both ways between Republican Street and Harrison Street.</FullDesc><TMCs><TMC code=\"114N08639\" /><TMC code=\"114-08639\" /><TMC code=\"114P08639\" /><TMC code=\"114+08639\" /></TMCs><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>9th Avenue</RoadName><Direction>BOTH</Direction><FromLocation>Seattle Northbound</FromLocation><ToLocation>Southbound</ToLocation><Crossroad1 tmcCode=\"114N08639\">Republican Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.06\" /></Incident><Incident id=\"820015692\" version=\"38\" type=\"1\" severity=\"2\" eventCode=\"735\" latitude=\"47.659818\" longitude=\"-122.314326\" impacting=\"Y\" startTime=\"2013-12-09T08:00:00Z\" endTime=\"2016-01-01T07:59:00Z\"><ShortDesc xml:lang=\"en-US\">Brooklyn Avenue : Road closed between 45th Street and 43rd Street </ShortDesc><FullDesc xml:lang=\"en-US\">Brooklyn Avenue both ways closed due to construction between 45th Street and 43rd Street.</FullDesc><TMCs /><ParameterizedDescription eventCode=\"735\"><EventText>Closed due to roadworks</EventText><RoadName>Brooklyn Avenue</RoadName><Direction>BOTH</Direction><Crossroad1>45th Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"820015928\" version=\"38\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.637746\" longitude=\"-122.36362\" impacting=\"Y\" startTime=\"2013-01-01T08:00:00Z\" endTime=\"2017-01-01T07:59:00Z\"><ShortDesc xml:lang=\"en-US\">Crockett Street : Partially blocked at 5th Avenue </ShortDesc><FullDesc xml:lang=\"en-US\">Parking restrictions in force and partially blocked due to construction on Crockett Street at 5th Avenue.</FullDesc><TMCs /><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>Crockett Street</RoadName><Direction>BOTH</Direction><Crossroad1>5th Avenue </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.49\" /><Head latitude=\"47.569618\" longitude=\"-122.339486\" /><Tails><Tail latitude=\"47.569618\" longitude=\"-122.339486\" /></Tails><LastDetourPoints><LastDetourPoint latitude=\"47.569618\" longitude=\"-122.339486\" /></LastDetourPoints></Incident><Incident id=\"820016544\" version=\"38\" type=\"1\" severity=\"2\" eventCode=\"738\" latitude=\"47.571647\" longitude=\"-122.339418\" impacting=\"Y\" startTime=\"2013-03-31T23:00:00Z\" endTime=\"2014-07-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">WA-99 Alaskan Way Via N/B : One lane closed between Idaho Street and Spokane Street </ShortDesc><FullDesc xml:lang=\"en-US\">One lane closed due to construction on WA-99 Alaskan Way Via Northbound between Idaho Street and Spokane Street.</FullDesc><TMCs><TMC code=\"114P04629\" /><TMC code=\"114+04629\" /></TMCs><ParameterizedDescription eventCode=\"738\"><EventText>Road construction. Left lane closed</EventText><RoadName>Wa-99 Alaskan Way Via</RoadName><Direction>NB</Direction><FromLocation>Southbound</FromLocation><ToLocation>Northbound</ToLocation><Crossroad1 tmcCode=\"114P04629\">Idaho Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.35\" /><Head latitude=\"47.569109\" longitude=\"-122.339354\" /><Tails><Tail latitude=\"47.569109\" longitude=\"-122.339354\" /></Tails><LastDetourPoints><LastDetourPoint latitude=\"47.569109\" longitude=\"-122.339354\" /></LastDetourPoints></Incident><Incident id=\"820016540\" version=\"38\" type=\"1\" severity=\"2\" eventCode=\"707\" latitude=\"47.565761\" longitude=\"-122.339474\" impacting=\"N\" startTime=\"2013-03-04T00:00:00Z\" endTime=\"2015-06-29T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">WA-99 S/B : Bridge maintenance work between Marginal and Nevada Street </ShortDesc><FullDesc xml:lang=\"en-US\">Intermittent lane closures due to construction and bridge maintenance work on WA-99 Southbound between Marginal / Spokane / W Seattle Brg and Nevada Street. Expect delays.</FullDesc><TMCs><TMC code=\"114N04629\" /><TMC code=\"114-04629\" /></TMCs><ParameterizedDescription eventCode=\"707\"><EventText>Bridge maintenance operations</EventText><RoadName>Wa-99</RoadName><Direction>SB</Direction><FromLocation>Northbound</FromLocation><ToLocation>Southbound</ToLocation><Crossroad1 tmcCode=\"114N04629\">Marginal / Spokane / W Seattle Brg </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.49\" /><Head latitude=\"47.569618\" longitude=\"-122.339486\" /><Tails><Tail latitude=\"47.569618\" longitude=\"-122.339486\" /></Tails><LastDetourPoints><LastDetourPoint latitude=\"47.569618\" longitude=\"-122.339486\" /></LastDetourPoints></Incident><Incident id=\"820016548\" version=\"38\" type=\"1\" severity=\"2\" eventCode=\"474\" latitude=\"47.624551\" longitude=\"-122.343673\" impacting=\"Y\" startTime=\"2013-06-04T23:00:00Z\" endTime=\"2014-07-31T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">WA-99 Aurora Avenue N/B : Exit ramp  closed at Mercer Street </ShortDesc><FullDesc xml:lang=\"en-US\">WA-99 Aurora Avenue Northbound exit ramp closed due to construction at Mercer Street.</FullDesc><TMCs><TMC code=\"114P04634\" /><TMC code=\"114+04634\" /></TMCs><ParameterizedDescription eventCode=\"474\"><EventText>Exit ramp closed</EventText><RoadName>Wa-99 Aurora Avenue</RoadName><Direction>NB</Direction><FromLocation>Southbound</FromLocation><ToLocation>Northbound</ToLocation><Crossroad1 tmcCode=\"114P04634\">Mercer Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.12\" /></Incident><Incident id=\"820016552\" version=\"39\" type=\"1\" severity=\"2\" eventCode=\"474\" latitude=\"47.623836\" longitude=\"-122.343742\" impacting=\"Y\" startTime=\"2013-07-09T23:00:00Z\" endTime=\"2015-07-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">WA-99 Aurora Avenue S/B : Exit ramp  closed at Broad Street </ShortDesc><FullDesc xml:lang=\"en-US\">WA-99 Aurora Avenue Southbound exit ramp closed due to construction at Broad Street.</FullDesc><TMCs><TMC code=\"114N04634\" /><TMC code=\"114-04634\" /></TMCs><ParameterizedDescription eventCode=\"474\"><EventText>Exit ramp closed</EventText><RoadName>Wa-99 Aurora Avenue</RoadName><Direction>SB</Direction><FromLocation>Northbound</FromLocation><ToLocation>Southbound</ToLocation><Crossroad1 tmcCode=\"114N04634\">Broad Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"842011204\" version=\"33\" type=\"1\" severity=\"2\" eventCode=\"738\" latitude=\"47.571647\" longitude=\"-122.339418\" impacting=\"N\" startTime=\"2014-02-28T08:00:00Z\" endTime=\"2014-06-03T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">WA-99 Alaskan Way Via : Lane closed at Spokane Street </ShortDesc><FullDesc xml:lang=\"en-US\">One lane closed due to construction on WA-99 Alaskan Way Via both ways around Spokane Street.</FullDesc><TMCs><TMC code=\"114N04629\" /><TMC code=\"114-04629\" /><TMC code=\"114P04629\" /><TMC code=\"114+04629\" /></TMCs><ParameterizedDescription eventCode=\"738\"><EventText>Road construction. Left lane closed</EventText><RoadName>Wa-99 Alaskan Way Via</RoadName><Direction>BOTH</Direction><FromLocation>Northbound</FromLocation><ToLocation>Southbound</ToLocation><Crossroad1 tmcCode=\"114N04629\">Spokane Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.96\" /><Head latitude=\"47.619647\" longitude=\"-122.320877\" /><Tails><Tail latitude=\"47.619647\" longitude=\"-122.320877\" /></Tails></Incident><Incident id=\"878657958\" version=\"25\" type=\"1\" severity=\"2\" eventCode=\"738\" latitude=\"47.6144\" longitude=\"-122.338375\" impacting=\"Y\" startTime=\"2014-03-03T08:00:00Z\" endTime=\"2014-06-03T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">6th Avenue E/B : Lane closed between Lenora Street and Virginia Street </ShortDesc><FullDesc xml:lang=\"en-US\">One lane closed due to construction on 6th Avenue Eastbound between Lenora Street and Virginia Street.</FullDesc><TMCs><TMC code=\"114N08572\" /><TMC code=\"114-08572\" /></TMCs><ParameterizedDescription eventCode=\"738\"><EventText>Road construction. Left lane closed</EventText><RoadName>6th Avenue</RoadName><Direction>EB</Direction><FromLocation>Belltown Northbound</FromLocation><ToLocation>Southbound</ToLocation><Crossroad1 tmcCode=\"114N08572\">Lenora Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"878657960\" version=\"25\" type=\"1\" severity=\"2\" eventCode=\"738\" latitude=\"47.615278\" longitude=\"-122.337863\" impacting=\"Y\" startTime=\"2014-03-03T08:00:00Z\" endTime=\"2014-06-02T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">7th Avenue W/B : Lane closed between Lenora Street and Westlake Avenue </ShortDesc><FullDesc xml:lang=\"en-US\">One lane closed due to construction on 7th Avenue Westbound between Lenora Street and Westlake Avenue.</FullDesc><TMCs><TMC code=\"114P08590\" /><TMC code=\"114+08590\" /></TMCs><ParameterizedDescription eventCode=\"738\"><EventText>Road construction. Left lane closed</EventText><RoadName>7th Avenue</RoadName><Direction>WB</Direction><FromLocation>Southbound</FromLocation><ToLocation>Northbound</ToLocation><Crossroad1 tmcCode=\"114P08590\">Lenora Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /><LastDetourPoints><LastDetourPoint latitude=\"47.608109\" longitude=\"-122.330196\" /></LastDetourPoints></Incident><Incident id=\"878703354\" version=\"25\" type=\"1\" severity=\"2\" eventCode=\"738\" latitude=\"47.614853\" longitude=\"-122.337796\" impacting=\"Y\" startTime=\"2014-03-03T08:00:00Z\" endTime=\"2014-06-04T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Virginia Street : Lane closed between 6th Avenue and Westlake Avenue </ShortDesc><FullDesc xml:lang=\"en-US\">One lane closed due to construction on Virginia Street both ways between 6th Avenue and Westlake Avenue.</FullDesc><TMCs /><ParameterizedDescription eventCode=\"738\"><EventText>Road construction. Left lane closed</EventText><RoadName>Virginia Street</RoadName><Direction>BOTH</Direction><Crossroad1>6th Avenue </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"878703362\" version=\"25\" type=\"1\" severity=\"2\" eventCode=\"738\" latitude=\"47.615826\" longitude=\"-122.338747\" impacting=\"Y\" startTime=\"2014-03-03T08:00:00Z\" endTime=\"2014-06-02T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Lenora Street S/B : Lane closed between 6th Avenue and 7th Avenue </ShortDesc><FullDesc xml:lang=\"en-US\">One lane closed due to construction on Lenora Street Southbound between 6th Avenue and 7th Avenue.</FullDesc><TMCs /><ParameterizedDescription eventCode=\"738\"><EventText>Road construction. Left lane closed</EventText><RoadName>Lenora Street</RoadName><Direction>SB</Direction><Crossroad1>6th Avenue </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"878842580\" version=\"25\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.616587\" longitude=\"-122.340071\" impacting=\"Y\" startTime=\"2014-03-03T08:00:00Z\" endTime=\"2014-06-04T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Blanchard Street : Bus staging lane blocked between 6th Avenue and 7th Avenue </ShortDesc><FullDesc xml:lang=\"en-US\">Bus staging lane blocked on Blanchard Street between 6th Avenue and 7th Avenue.</FullDesc><TMCs /><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>Blanchard Street</RoadName><Direction>BOTH</Direction><Crossroad1>6th Avenue </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"890764048\" version=\"22\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.620899\" longitude=\"-122.34501\" impacting=\"Y\" startTime=\"2014-03-09T08:00:00Z\" endTime=\"2015-01-01T07:59:00Z\"><ShortDesc xml:lang=\"en-US\">Thomas Street W/B : Parking restrictions in force between WA-99 Aurora Avenue and 6th Avenue </ShortDesc><FullDesc xml:lang=\"en-US\">Parking restrictions in force due to construction on Thomas Street Westbound between WA-99 Aurora Avenue and 6th Avenue.</FullDesc><TMCs /><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>Thomas Street</RoadName><Direction>WB</Direction><Crossroad1>WA-99 Aurora Avenue </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"893898368\" version=\"22\" type=\"1\" severity=\"2\" eventCode=\"735\" latitude=\"47.59043\" longitude=\"-122.337386\" impacting=\"Y\" startTime=\"2014-03-11T00:00:00Z\" endTime=\"2014-05-02T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Atlantic Street : Road closed between Colorado Avenue and Alaskan Way </ShortDesc><FullDesc xml:lang=\"en-US\">Atlantic Street both ways closed due to construction between Colorado Avenue and Alaskan Way.</FullDesc><TMCs><TMC code=\"114N09760\" /><TMC code=\"114-09760\" /><TMC code=\"114P09760\" /><TMC code=\"114+09760\" /></TMCs><ParameterizedDescription eventCode=\"735\"><EventText>Closed due to roadworks</EventText><RoadName>Atlantic Street</RoadName><Direction>BOTH</Direction><FromLocation>Eastbound</FromLocation><ToLocation>Westbound</ToLocation><Crossroad1 tmcCode=\"114N09760\">Colorado Avenue </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"956776056\" version=\"11\" type=\"1\" severity=\"2\" eventCode=\"735\" latitude=\"47.623224\" longitude=\"-122.344127\" impacting=\"Y\" startTime=\"2014-04-01T23:00:00Z\" endTime=\"2014-05-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">6th Avenue : Road closed between Thomas Street and Repuplican Street </ShortDesc><FullDesc xml:lang=\"en-US\">6th Avenue both ways closed due to WA-99 Tunnel Project between Thomas Street and Repuplican Street.</FullDesc><TMCs><TMC code=\"114N08574\" /><TMC code=\"114-08574\" /><TMC code=\"114P08574\" /><TMC code=\"114+08574\" /></TMCs><ParameterizedDescription eventCode=\"735\"><EventText>Closed due to roadworks</EventText><RoadName>6th Avenue</RoadName><Direction>BOTH</Direction><FromLocation>Belltown Northbound</FromLocation><ToLocation>Southbound</ToLocation><Crossroad1 tmcCode=\"114N08574\">Thomas Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"956784334\" version=\"11\" type=\"1\" severity=\"2\" eventCode=\"735\" latitude=\"47.647463\" longitude=\"-122.377498\" impacting=\"Y\" startTime=\"2014-03-20T08:00:00Z\" endTime=\"2014-07-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Barrett Street W/B : Road closed between 17th Avenue and 16th Avenue </ShortDesc><FullDesc xml:lang=\"en-US\">Barrett Street Westbound closed; no through traffic allowed due to construction between 17th Avenue and 16th Avenue. Expect delays.</FullDesc><TMCs /><ParameterizedDescription eventCode=\"735\"><EventText>Closed due to roadworks</EventText><RoadName>Barrett Street</RoadName><Direction>WB</Direction><Crossroad1>17th Avenue </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"956784342\" version=\"13\" type=\"1\" severity=\"2\" eventCode=\"735\" latitude=\"47.64846\" longitude=\"-122.378893\" impacting=\"Y\" startTime=\"2014-03-20T08:00:00Z\" endTime=\"2014-07-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">17th Avenue N/B : Road closed between Barrett Street and Dravus Street </ShortDesc><FullDesc xml:lang=\"en-US\">17th Avenue Northbound closed due to construction between Barrett Street and Dravus Street. Expect delays.</FullDesc><TMCs /><ParameterizedDescription eventCode=\"735\"><EventText>Closed due to roadworks</EventText><RoadName>17th Avenue</RoadName><Direction>NB</Direction><Crossroad1>Barrett Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"956818554\" version=\"11\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.64846\" longitude=\"-122.378893\" impacting=\"Y\" startTime=\"2014-03-20T08:00:00Z\" endTime=\"2014-07-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Dravus Street W/B : Construction between 16th Avenue and 17th Avenue </ShortDesc><FullDesc xml:lang=\"en-US\">Intermittent lane closures due to construction on Dravus Street Westbound between 16th Avenue and 17th Avenue. Expect delays.</FullDesc><TMCs><TMC code=\"114N10200\" /><TMC code=\"114-10200\" /></TMCs><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>Dravus Street</RoadName><Direction>WB</Direction><FromLocation>Interbay Eastbound</FromLocation><ToLocation>Westbound</ToLocation><Crossroad1 tmcCode=\"114N10200\">16th Avenue </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.02\" /><Head latitude=\"47.648433\" longitude=\"-122.382061\" /><Tails><Tail latitude=\"47.648433\" longitude=\"-122.382061\" /></Tails><LastDetourPoints><LastDetourPoint latitude=\"47.648433\" longitude=\"-122.382061\" /></LastDetourPoints></Incident><Incident id=\"975575296\" version=\"8\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.620722\" longitude=\"-122.34761\" impacting=\"Y\" startTime=\"2014-04-07T23:00:00Z\" endTime=\"2014-05-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Broad Street : Construction between John Street and Monorail </ShortDesc><FullDesc xml:lang=\"en-US\">Intermittent lane closures due to construction on Broad Street both ways between John Street and Monorail.</FullDesc><TMCs><TMC code=\"114N09920\" /><TMC code=\"114-09920\" /><TMC code=\"114P09920\" /><TMC code=\"114+09920\" /></TMCs><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>Broad Street</RoadName><Direction>BOTH</Direction><FromLocation>Seattle Eastbound</FromLocation><ToLocation>Belltown Westbound</ToLocation><Crossroad1 tmcCode=\"114N09920\">John Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" /></Incident><Incident id=\"975575298\" version=\"8\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.622006\" longitude=\"-122.334339\" impacting=\"Y\" startTime=\"2014-04-07T23:00:00Z\" endTime=\"2014-05-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Fairview Avenue S/B : Construction between Republican Street and Harrison Street </ShortDesc><FullDesc xml:lang=\"en-US\">Intermittent lane closures due to construction on Fairview Avenue Southbound between Republican Street and Harrison Street.</FullDesc><TMCs><TMC code=\"114N10273\" /><TMC code=\"114-10273\" /></TMCs><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>Fairview Avenue</RoadName><Direction>SB</Direction><FromLocation>Capitol Hill Northbound</FromLocation><ToLocation>Southbound</ToLocation><Crossroad1 tmcCode=\"114N10273\">Republican Street </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.02\" /><Head latitude=\"47.624651\" longitude=\"-122.334382\" /><Tails><Tail latitude=\"47.624651\" longitude=\"-122.334382\" /></Tails><LastDetourPoints><LastDetourPoint latitude=\"47.624651\" longitude=\"-122.334382\" /></LastDetourPoints></Incident><Incident id=\"979365686\" version=\"7\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.601705\" longitude=\"-122.320739\" impacting=\"Y\" startTime=\"2014-04-08T07:00:00Z\" endTime=\"2014-09-24T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Broadway : Construction between Denny Way and Yesler Way </ShortDesc><FullDesc xml:lang=\"en-US\">Intermittent lane closures due to construction on Broadway both ways between Denny Way and Yesler Way.</FullDesc><TMCs><TMC code=\"114N09923\" /><TMC code=\"114-09923\" /><TMC code=\"114N09924\" /><TMC code=\"114-09924\" /><TMC code=\"114P09925\" /><TMC code=\"114+09925\" /><TMC code=\"114P09924\" /><TMC code=\"114+09924\" /></TMCs><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>Broadway</RoadName><Direction>BOTH</Direction><FromLocation>Capitol Hill Northbound</FromLocation><ToLocation>Yesler Terrace Southbound</ToLocation><Crossroad1 tmcCode=\"114N09925\">Denny Way </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"1.62\" /></Incident><Incident id=\"979377850\" version=\"7\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.599212\" longitude=\"-122.332909\" impacting=\"Y\" startTime=\"2014-04-08T23:00:00Z\" endTime=\"2014-09-24T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Jackson Street : Construction between 14th Avenue and Occidental Avenue </ShortDesc><FullDesc xml:lang=\"en-US\">Intermittent lane closures due to construction on Jackson Street both ways between 14th Avenue / Boren Avenue and Occidental Avenue.</FullDesc><TMCs><TMC code=\"114N10501\" /><TMC code=\"114-10501\" /><TMC code=\"114N10502\" /><TMC code=\"114-10502\" /><TMC code=\"114N10503\" /><TMC code=\"114-10503\" /><TMC code=\"114P10504\" /><TMC code=\"114+10504\" /><TMC code=\"114P10503\" /><TMC code=\"114+10503\" /><TMC code=\"114P10502\" /><TMC code=\"114+10502\" /></TMCs><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>Jackson Street</RoadName><Direction>BOTH</Direction><FromLocation>Madrona Eastbound</FromLocation><ToLocation>Westbound</ToLocation><Crossroad1 tmcCode=\"114N10504\">14th Avenue / Boren Avenue </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.94\" /></Incident><Incident id=\"995972644\" version=\"5\" type=\"1\" severity=\"2\" eventCode=\"701\" latitude=\"47.626255\" longitude=\"-122.343619\" impacting=\"Y\" startTime=\"2014-04-22T04:00:26Z\" endTime=\"2014-04-22T12:00:26Z\"><ShortDesc xml:lang=\"en-US\">WA-99 N/B : Right lane closed between Western Avenue and Valley Street </ShortDesc><FullDesc xml:lang=\"en-US\">Right lane closed due to electricity work on WA-99 Northbound between Western Avenue and Valley Street.</FullDesc><TMCs><TMC code=\"114P04635\" /><TMC code=\"114+04635\" /><TMC code=\"114P04634\" /><TMC code=\"114+04634\" /><TMC code=\"114P04633\" /><TMC code=\"114+04633\" /></TMCs><ParameterizedDescription eventCode=\"701\"><EventText>Road construction</EventText><RoadName>Wa-99</RoadName><Direction>NB</Direction><FromLocation>Southbound</FromLocation><ToLocation>Northbound</ToLocation><Crossroad1 tmcCode=\"114P04632\">Western Avenue </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.86\" /><Head latitude=\"47.624600\" longitude=\"-122.343602\" /><Tails><Tail latitude=\"47.616761\" longitude=\"-122.344354\" /></Tails><LastDetourPoints><LastDetourPoint latitude=\"47.613523\" longitude=\"-122.347805\" /></LastDetourPoints></Incident><Incident id=\"995972646\" version=\"5\" type=\"1\" severity=\"2\" eventCode=\"406\" latitude=\"47.61858\" longitude=\"-122.34356\" impacting=\"Y\" startTime=\"2014-04-22T04:00:26Z\" endTime=\"2014-04-22T12:00:26Z\"><ShortDesc xml:lang=\"en-US\">WA-99 N/B : Entry ramp  closed at Denny Way </ShortDesc><FullDesc xml:lang=\"en-US\">WA-99 Northbound entry ramp closed due to electricity work at Denny Way.</FullDesc><TMCs><TMC code=\"114P04633\" /><TMC code=\"114+04633\" /></TMCs><ParameterizedDescription eventCode=\"406\"><EventText>On-ramp closed</EventText><RoadName>Wa-99</RoadName><Direction>NB</Direction><FromLocation>Southbound</FromLocation><ToLocation>Northbound</ToLocation><Crossroad1 tmcCode=\"114P04633\">Denny Way </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.03\" fromFreeFlowMinutes=\"0.03\" distance=\"2.56\" /><Head latitude=\"47.633651\" longitude=\"-122.187759\" /><Tails><Tail latitude=\"47.647148\" longitude=\"-122.187134\" /></Tails><LastDetourPoints><LastDetourPoint latitude=\"47.670246\" longitude=\"-122.187191\" /></LastDetourPoints></Incident><Incident id=\"1017415000\" version=\"1\" type=\"1\" severity=\"2\" eventCode=\"474\" latitude=\"47.61858\" longitude=\"-122.34356\" impacting=\"Y\" startTime=\"2014-04-22T06:30:00Z\" endTime=\"2014-04-22T12:00:00Z\"><ShortDesc xml:lang=\"en-US\">WA-99 N/B : Exit ramp  closed at Denny Way </ShortDesc><FullDesc xml:lang=\"en-US\">WA-99 Northbound exit ramp closed due to construction at Denny Way.</FullDesc><TMCs><TMC code=\"114P04633\" /><TMC code=\"114+04633\" /></TMCs><ParameterizedDescription eventCode=\"474\"><EventText>Exit ramp closed</EventText><RoadName>Wa-99</RoadName><Direction>NB</Direction><FromLocation>Southbound</FromLocation><ToLocation>Northbound</ToLocation><Crossroad1 tmcCode=\"114P04633\">Denny Way </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.86\" /><Head latitude=\"47.624600\" longitude=\"-122.343602\" /><Tails><Tail latitude=\"47.616761\" longitude=\"-122.344354\" /></Tails><LastDetourPoints><LastDetourPoint latitude=\"47.613523\" longitude=\"-122.347805\" /></LastDetourPoints></Incident><Incident id=\"1017414998\" version=\"1\" type=\"1\" severity=\"2\" eventCode=\"738\" latitude=\"47.64439\" longitude=\"-122.30446\" impacting=\"N\" startTime=\"2014-04-22T04:00:00Z\" endTime=\"2014-04-22T13:00:00Z\"><ShortDesc xml:lang=\"en-US\">WA-520 : Lane closed at Montlake Boulevard </ShortDesc><FullDesc xml:lang=\"en-US\">Lane closed due to construction on WA-520 both ways near Montlake Boulevard.</FullDesc><TMCs><TMC code=\"114N04229\" /><TMC code=\"114-04229\" /><TMC code=\"114P04229\" /><TMC code=\"114+04229\" /></TMCs><ParameterizedDescription eventCode=\"738\"><EventText>Road construction. Left lane closed</EventText><RoadName>Wa-520</RoadName><Direction>BOTH</Direction><FromLocation>Redmond Eastbound</FromLocation><ToLocation>Broadway Westbound</ToLocation><Crossroad1 tmcCode=\"114N04229\">Montlake Boulevard </Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.91\" /><Head latitude=\"47.612165\" longitude=\"-122.338609\" /><Tails><Tail latitude=\"47.612165\" longitude=\"-122.338609\" /></Tails><LastDetourPoints><LastDetourPoint latitude=\"47.606097\" longitude=\"-122.332937\" /></LastDetourPoints></Incident><Incident id=\"893908474\" version=\"1\" type=\"3\" severity=\"2\" eventCode=\"401\" latitude=\"47.59037\" longitude=\"-122.33749\" impacting=\"Y\" startTime=\"2014-03-11T00:00:00Z\" endTime=\"2014-05-02T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Closed on S Atlantic St/Edgar Martinez Dr EB at Alaskan Way</ShortDesc><FullDesc xml:lang=\"en-US\">Closed on S Atlantic St/Edgar Martinez Dr EB at Alaskan Way</FullDesc><TMCs><TMC code=\"114P09760\" /><TMC code=\"114+09760\" /></TMCs><ParameterizedDescription eventCode=\"401\"><EventText>Closed</EventText><RoadName>S Atlantic St/Edgar Martinez Dr</RoadName><Direction>EB</Direction><Crossroad1 tmcCode=\"114P09760\">Alaskan Way</Crossroad1><Position1>at</Position1></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" abnormal=\"false\" /></Incident><Incident id=\"893908476\" version=\"1\" type=\"3\" severity=\"2\" eventCode=\"401\" latitude=\"47.59037\" longitude=\"-122.33749\" impacting=\"Y\" startTime=\"2014-03-11T00:00:00Z\" endTime=\"2014-05-02T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Closed on S Atlantic St/Edgar Martinez Dr WB at Alaskan Way</ShortDesc><FullDesc xml:lang=\"en-US\">Closed on S Atlantic St/Edgar Martinez Dr WB at Alaskan Way</FullDesc><TMCs><TMC code=\"114N09760\" /><TMC code=\"114-09760\" /></TMCs><ParameterizedDescription eventCode=\"401\"><EventText>Closed</EventText><RoadName>S Atlantic St/Edgar Martinez Dr</RoadName><Direction>WB</Direction><Crossroad1 tmcCode=\"114N09760\">Alaskan Way</Crossroad1><Position1>at</Position1></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" abnormal=\"false\" /><LastDetourPoints><LastDetourPoint latitude=\"47.590300\" longitude=\"-122.334328\" /></LastDetourPoints></Incident><Incident id=\"907989278\" version=\"2\" type=\"3\" severity=\"2\" eventCode=\"401\" latitude=\"47.59037\" longitude=\"-122.33749\" impacting=\"Y\" startTime=\"2014-03-31T23:00:00Z\" endTime=\"2014-05-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Closed on Alaskan Way between Madison St and S Atlantic St</ShortDesc><FullDesc xml:lang=\"en-US\">Closed on Alaskan Way between Madison St and S Atlantic St</FullDesc><TMCs><TMC code=\"114N08074\" /><TMC code=\"114-08074\" /><TMC code=\"114N08075\" /><TMC code=\"114-08075\" /><TMC code=\"114N08076\" /><TMC code=\"114-08076\" /><TMC code=\"114N08077\" /><TMC code=\"114-08077\" /></TMCs><ParameterizedDescription eventCode=\"401\"><EventText>Closed</EventText><RoadName>Alaskan Way</RoadName><Crossroad1 tmcCode=\"114N08078\">Madison St</Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.96\" abnormal=\"true\" /><Head latitude=\"47.591204\" longitude=\"-122.337050\" /><Tails><Tail latitude=\"47.603455\" longitude=\"-122.338111\" /></Tails><LastDetourPoints><LastDetourPoint latitude=\"47.607359\" longitude=\"-122.341886\" /></LastDetourPoints></Incident><Incident id=\"956389980\" version=\"1\" type=\"3\" severity=\"2\" eventCode=\"401\" latitude=\"47.60179\" longitude=\"-122.33663\" impacting=\"Y\" startTime=\"2014-03-31T23:00:00Z\" endTime=\"2014-05-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Closed on Alaskan Way between S Atlantic St and Yesler Way</ShortDesc><FullDesc xml:lang=\"en-US\">Closed on Alaskan Way between S Atlantic St and Yesler Way</FullDesc><TMCs><TMC code=\"114P08076\" /><TMC code=\"114+08076\" /><TMC code=\"114P08075\" /><TMC code=\"114+08075\" /></TMCs><ParameterizedDescription eventCode=\"401\"><EventText>Closed</EventText><RoadName>Alaskan Way</RoadName><Crossroad1 tmcCode=\"114P08074\">S Atlantic St</Crossroad1><Position1>between</Position1><Position2>and</Position2></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.79\" abnormal=\"true\" /><Head latitude=\"47.597610\" longitude=\"-122.335934\" /><Tails><Tail latitude=\"47.591962\" longitude=\"-122.336700\" /></Tails></Incident><Incident id=\"956787772\" version=\"1\" type=\"3\" severity=\"2\" eventCode=\"401\" latitude=\"47.61805\" longitude=\"-122.34449\" impacting=\"Y\" startTime=\"2014-04-01T23:00:00Z\" endTime=\"2014-05-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Closed on 6th Ave at Wall St</ShortDesc><FullDesc xml:lang=\"en-US\">Closed on 6th Ave at Wall St</FullDesc><TMCs><TMC code=\"114N08574\" /><TMC code=\"114-08574\" /></TMCs><ParameterizedDescription eventCode=\"401\"><EventText>Closed</EventText><RoadName>6th Ave</RoadName><Crossroad1 tmcCode=\"114N08574\">Wall St</Crossroad1><Position1>at</Position1></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" abnormal=\"true\" /><LastDetourPoints><LastDetourPoint latitude=\"47.621960\" longitude=\"-122.345007\" /></LastDetourPoints></Incident><Incident id=\"956787774\" version=\"1\" type=\"3\" severity=\"2\" eventCode=\"401\" latitude=\"47.61805\" longitude=\"-122.34449\" impacting=\"Y\" startTime=\"2014-04-01T23:00:00Z\" endTime=\"2014-05-01T06:59:00Z\"><ShortDesc xml:lang=\"en-US\">Closed on 6th Ave at Wall St</ShortDesc><FullDesc xml:lang=\"en-US\">Closed on 6th Ave at Wall St</FullDesc><TMCs><TMC code=\"114P08574\" /><TMC code=\"114+08574\" /></TMCs><ParameterizedDescription eventCode=\"401\"><EventText>Closed</EventText><RoadName>6th Ave</RoadName><Crossroad1 tmcCode=\"114P08574\">Wall St</Crossroad1><Position1>at</Position1></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" abnormal=\"true\" /><LastDetourPoints><LastDetourPoint latitude=\"47.617649\" longitude=\"-122.343835\" /></LastDetourPoints></Incident><Incident id=\"1018431012\" version=\"1\" type=\"3\" severity=\"2\" eventCode=\"401\" latitude=\"47.62326\" longitude=\"-122.34363\" impacting=\"Y\" startTime=\"2014-04-20T20:51:12Z\" endTime=\"2014-04-22T20:54:45Z\"><ShortDesc xml:lang=\"en-US\">Closed on 6th Ave at WA-99/Aurora Ave</ShortDesc><FullDesc xml:lang=\"en-US\">Closed on 6th Ave at WA-99/Aurora Ave</FullDesc><TMCs><TMC code=\"114P08575\" /><TMC code=\"114+08575\" /></TMCs><ParameterizedDescription eventCode=\"401\"><EventText>Closed</EventText><RoadName>6th Ave</RoadName><Crossroad1 tmcCode=\"114P08575\">WA-99/Aurora Ave</Crossroad1><Position1>at</Position1></ParameterizedDescription><DelayImpact fromTypicalMinutes=\"0.00\" fromFreeFlowMinutes=\"0.00\" distance=\"0.00\" abnormal=\"true\" /><LastDetourPoints><LastDetourPoint latitude=\"47.622038\" longitude=\"-122.344973\" /></LastDetourPoints></Incident></Incidents></Inrix>";

	@Before
	public void setup() {
		ShadowLog.stream = System.out;
		InrixCore.initialize(Robolectric.application);
	}

	@After
	public void teardown() {

	}

	@Test
	public void testIncidentsFragmentContent() {
		initIncidentsFragment();
		List<Incident> incList = getIncidentsList(incidentsXml);
		setIncidentsList(incList);
		Robolectric.shadowOf(incidentsListView).populateItems();
		int countOfItems = incidentsListView.getCount();
		assertEquals(incList.size(), countOfItems);

		for (int i = 0; i < countOfItems; i++) {
			IncidentCard incCard = (IncidentCard) incidentsListView
					.getChildAt(i);
			verifyCardMatchesIncident(incCard, incList.get(i));
		}
	}

	@Test
	public void testIncidentsSortSeverity() {
		Location seattleLoc = new Location("SeattleLocation");
		seattleLoc.setLatitude(47.643549700);
		seattleLoc.setLongitude(-122.207828700);
		initIncidentsFragment();
		List<Incident> incList = getIncidentsList(incidentsXml);
		processResult(incList);

		setDistance(incList);
		Collections.sort(incList, IncidentUtils.getDefaultListComparator());
		// can't call onResult as currentIncidentRequest is null
		// incidentsFrag.onResult(incList);

		Robolectric.shadowOf(incidentsListView).populateItems();
		int countOfItems = incidentsListView.getCount();
		assertEquals(incList.size(), countOfItems);
		IncidentCard incCard = (IncidentCard) incidentsListView.getChildAt(0);
		verifyCardMatchesSortOrder(incCard, incList);

	}

	private void verifyCardMatchesSortOrder(IncidentCard card,
			List<Incident> incList) {

		assertTrue(incList.get(0).getSeverity() >= incList.get(0).getSeverity());

		TextView titleView = (TextView) card.findViewById(R.id.title);

		assertEquals(titleView.getText().toString(),
				IncidentDisplayUtils.getDescription(Robolectric.application,
						incList.get(0)));

	}

	private void verifyCardMatchesIncident(IncidentCard card, Incident inc) {
		assertNotNull(card);
		assertNotNull(inc);
		String title = IncidentDisplayUtils.getDescription(Robolectric.application, inc);

		TextView titleView = (TextView) card.findViewById(R.id.title);
		ImageView incidentIcon = (ImageView) card.findViewById(R.id.thumbnail);

		if (null != title) {
			assertEquals(title, titleView.getText().toString());
		}
		verifyIconResource(incidentIcon, inc);
	}

	private void verifyIconResource(ImageView icon, Incident incident) {
		assertNotNull(icon);
		int iconID = IncidentDisplayUtils.getIcon(incident);
		ShadowDrawable shadowDrawable = Robolectric
				.shadowOf(icon.getDrawable());

		int shadowResource = shadowDrawable.getCreatedFromResId();
		assertEquals(iconID, shadowResource);
	}

	private void initIncidentsFragment() {
		incidentsFrag = new IncidentsListFragment();
		FragmentUtils.startv4Fragment(incidentsFrag);
		assertNotNull(incidentsFrag);
		incidentsListView = incidentsFrag.getListView();
		assertNotNull(incidentsListView);
	}

	@SuppressWarnings("rawtypes")
	private void setIncidentsList(List<Incident> incidentList) {
		try {
			Class[] cArg = new Class[1];
			cArg[0] = List.class;
			Method setIncidentsMethod = IncidentsListFragment.class
					.getDeclaredMethod("setIncidentList", cArg);
			setIncidentsMethod.setAccessible(true);
			setIncidentsMethod.invoke(incidentsFrag, incidentList);
		} catch (Exception ex) {
			ex.printStackTrace();
		}
	}

	@SuppressWarnings("rawtypes")
	private void setDistance(List<Incident> incidentList) {
		try {
			Class[] cArg = new Class[1];
			cArg[0] = List.class;
			Method setDistanceMethod = IncidentsListFragment.class
					.getDeclaredMethod("setDistance", cArg);
			setDistanceMethod.setAccessible(true);
			setDistanceMethod.invoke(incidentsFrag, incidentList);
		} catch (Exception ex) {
			ex.printStackTrace();
		}
	}

	@SuppressWarnings("rawtypes")
	private void processResult(List<Incident> incidentList) {
		try {
			Class[] cArg = new Class[1];
			cArg[0] = List.class;
			Method processResultMethod = IncidentsListFragment.class
					.getDeclaredMethod("processResult", cArg);
			processResultMethod.setAccessible(true);
			processResultMethod.invoke(incidentsFrag, incidentList);
		} catch (Exception ex) {
			ex.printStackTrace();
		}
	}

	private List<Incident> getIncidentsList(String xml) {
		assertFalse(TextUtils.isEmpty(xml));
		final Serializer serializer = new Persister();
		try {
			IncidentCollection incidentColl = serializer.read(
					IncidentCollection.class, xml);
			return incidentColl.getIncidents();
		} catch (Exception e) {
			e.printStackTrace();
		}
		return null;
	}

}
